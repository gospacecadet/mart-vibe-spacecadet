<template name="manageProperty">
  <div class="container-fluid">
    <div class="row m-a-2 p-a-2">
      <div class="col-md-5 col-md-offset-1 white-box p-y-2">
        {{#with property}}
          <h3>Edit Property</h3>
          <hr>
          {{> managePropertyImages}}
          <hr>
          {{> managePropertyDetails}}
        {{/with}}
      </div>
      <div class="col-md-5 white-box p-y-2">
        {{#with property}}
          <h3>Manage rentable Spaces</h3>
          <hr>
          {{> manageSpaces}}
          <hr>
          {{> newSpace}}
        {{/with}}
      </div>
    </div>
  </div>
</template>

<template name="managePropertyImages">
  <h4>Upload Property images</h4>
  <p>
    You may upload up to four photos.
    They will appear to the public in clockwise order.
  </p>
  <div class="row">
    {{#each numImagesAllowed}}
      <div class="col-md-6">
        {{> uploadPropertyImage index=index propertyId=_id }}
      </div>
    {{/each}}
  </div>
</template>

<template name="managePropertyDetails">
  {{#autoForm collection="Mart.Storefronts" id="updatePropertyForm" type="update" doc=this}}

    <fieldset>
      {{> managePropertyFields}}
    </fieldset>

    <hr>
    <button type="submit" class="btn btn-primary btn-lg btn-block m-t-2">Save changes</button>
    <button id="publish-property" class='btn btn-primary-outline btn-lg btn-block m-t-1'>Publish</button>

  {{/autoForm}}
</template>

<template name="managePropertyFields">
  <h4>Name &amp; Description</h4>
  {{> afQuickField name='name'}}
  {{> afQuickField name='description' type='textarea' rows=4}}

  <hr>
  <h4>Location Details</h4>
  {{> afQuickField name='address'}}
  {{> afQuickField name='address2'}}

  <div class='row'>
    <div class='col-md-6'>
      {{> afQuickField name='city'}}
    </div>
    <div class='col-md-6'>
      {{> afQuickField name='state'}}
    </div>
  </div>

  <div class='row'>
    <div class='col-md-6'>
      {{> afQuickField name='zip'}}
    </div>
    <div class='col-md-6'>
    </div>
  </div>
</template>

<template name="uploadPropertyImage">
  <img src={{url}} class="img-rounded img-fluid m-t-2"/>

  {{#if uploading}}
    <progress class="progress progress-striped progress-success" value="{{progress}}" max="100">{{progress}}%</progress>
  {{/if}}

  <form>
      <label class="file">
        <input type="file" id="property-image-{{index}}">
        <span class="file-custom"></span>
      </label>
    <button type="submit" class="btn btn-primary btn-upload btn-block btn-sm">Upload</button>
  </form>
</template>

<template name="newSpace">
  <h4>Create a new Space for rent</h4>
  {{#autoForm collection="Mart.Products" id="new-space-form" type="insert"}}
    <fieldset>
      {{> afQuickField name='name'}}
      {{> afQuickField name='description' type='textarea' rows=4}}
    </fieldset>
    <button type="submit" class="btn btn-primary btn-lg btn-block">Create Space</button>
    <p class="text-muted m-a-1">
      You will be able to continue editing before the Space is made visible to the public.
    </p>
  {{/autoForm}}
</template>

<template name="manageSpaces">
  <h4>Existing Spaces</h4>
  <ul>
    {{#each spaces}}
      <li>
        <a href="{{manageSpacePath _id propertyId}}" class="btn btn-link">
          {{name}}
        </a>
      </li>
    {{/each}}
  </ul>

</template>
