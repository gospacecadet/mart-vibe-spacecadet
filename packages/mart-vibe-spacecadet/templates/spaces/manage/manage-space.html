<template name="manageSpace">
<div class="container-fluid">
  <div class="row m-a-2 p-a-2">
    <div class="col-md-10 col-md-offset-1 white-box p-y-2">
      <div class="row">
        <div class="col-md-8 col-md-offset-2">
          <h3><strong>Edit &amp; Publish Space</strong></h3>
        </div>
      </div>
      <hr>
      {{#with space}}
        {{> manageSpacePrices}}

        {{#autoForm collection="Mart.Products" id="updateSpaceForm" type="update" doc=this}}
          {{> manageSpaceDetails}}
          {{> manageSpaceImages}}
          <hr>
          <button type="submit" class="btn btn-primary btn-lg btn-block m-t-3">Save changes</button>
          <button id="publish-space" class='btn btn-primary-outline btn-lg btn-block m-t-1'>Publish</button>
        {{/autoForm}}

      {{/with}}
    </div>
  </div>
</div>
</template>


<template name="manageSpaceImages">
  <div class="row m-t-2 p-b-1">
    <div class="col-md-2">
      <h4 class="text-xs-right"><strong>Step 3</strong></h4>
    </div>
    <div class="col-md-8">
      <h4>Upload Station Images</h4>
      <p class="text-muted">
        You may upload up to four photos.
        They will appear to the public in clockwise order.
      </p>
      <div class="row">
        {{#each numImagesAllowed}}
          <div class="col-md-6">
            {{> uploadSpaceImage index=index propertyId=_id }}
          </div>
        {{/each}}
      </div>
    </div>
  </div>

</template>

<template name="uploadSpaceImage">
  <img src={{url}} class="img-rounded img-fluid m-t-1"/>

  {{#if uploading}}
    <progress class="progress progress-striped progress-success" value="{{progress}}" max="100">{{progress}}%</progress>
  {{/if}}

  <form>
      <label class="file">
        <input type="file" id="property-image-{{index}}">
        <span class="file-custom"></span>
      </label>
    <button type="submit" class="btn btn-outline-primary btn-upload btn-block btn-sm m-b-2">Upload</button>
  </form>
</template>

<template name="manageSpaceDetails">
  <div class="row m-t-3">
    <div class="col-md-2">
      <h4 class="text-xs-right"><strong>Step 2</strong></h4>
    </div>
    <div class="col-md-8">
      <h4>Name &amp; Description</h4>
      <fieldset class="m-t-1">
        {{> afQuickField name='name'}}
        {{> afQuickField name='description' type='textarea' rows=4}}
      </fieldset>

    </div>
  </div>
</template>

<template name="manageSpacePrices">
  <div class="row">
    <div class="col-md-2">
      <h4 class="text-xs-right"><strong>Step 1</strong></h4>
    </div>
    <div class="col-md-8">
      <h4 class="m-b-2">Pricing</h4>

      {{#each prices}}
        {{#if this}}
          {{> editPrice}}
        {{else}}
          {{> newPrice unit="hour" productId=_id}}
        {{/if}}
      {{/each}}
    </div>
  </div>
</template>

<template name="editPrice">
  {{#autoForm collection="Mart.Prices" id=id type="update" doc=this}}
  <div class="row m-t-1">
    <div class="col-md-3">
      <h4 class="text-capitalize">
        <span class="label label-pill label-primary p-a-1">{{unit}}ly Price*</span>
      </h4>
    </div>
    <div class="col-md-6">
      <fieldset>
        <div class="form-group">
          <label class="sr-only" for="exampleInputAmount">Amount (in dollars)</label>
          <div class="input-group">
            <div class="input-group-addon">$</div>
            {{> afFieldInput name='priceInCents' class="form-control space-price" type="text" value=priceInDollars}}
          </div>
        </div>
      </fieldset>
    </div>
    <div class='col-md-3'>
      <button type="submit" class="btn btn-outline-primary btn-sm">Update {{unit}}ly price</button>
    </div>
  </div>
  {{/autoForm}}
  <div class="row">
    {{#if connectionCharge}}
      <p class='text-muted'>
        <small>
          This is the price the renters will see.
          The SpaceCadet connection charge will be
          <strong>{{money connectionCharge}}</strong>
          and you will receive
          <strong>{{money landlordCut}}</strong>
        </small>
      </p>
    {{/if}}
  </div>
</template>

<template name="priceExplanation">
  {{#if connectionCharge}}
    <p class='text-muted'>
      <small>
        This is the price the renters will see.
        The SpaceCadet connection charge will be
        <strong>{{money connectionCharge}}</strong>
        and you will receive
        <strong>{{money landlordCut}}</strong>{{landlordCut}}
      </small>
    </p>
  {{/if}}
</template>

<template name="newPrice">
  {{#autoForm collection="Mart.Prices" id=id type="update" doc=this}}
  <div class="row m-t-1">
    <div class="col-md-3">
      <h4 class="text-capitalize">
        <span class="label label-pill label-primary p-a-1">{{unit}}ly Price*</span>
      </h4>
    </div>
    <div class="col-md-6">
      <fieldset>
        <div class="form-group">
          <label class="sr-only" for="exampleInputAmount">Amount (in dollars)</label>
          <div class="input-group">
            <div class="input-group-addon">$</div>
            {{> afFieldInput name='priceInCents' class="form-control space-price" type="text" value="Price not set"}}
            {{> afQuickField name='unit' type="hidden" value=unit}}
            {{> afQuickField name='productId' type="hidden" value=productId}}
          </div>
        </div>
      </fieldset>
    </div>
    <div class='col-md-3'>
      <button type="submit" class="btn btn-outline-primary btn-sm">Set {{unit}}ly price</button>
    </div>
  </div>
  {{/autoForm}}
</template>
